# 🔴🟢🔵 Step 2: TDD の基本

## 目標

- TDD（テスト駆動開発）の基本サイクルを理解する
- 簡単な例で Red → Green → Refactor を体験する

---

## 2.1 TDD とは？

**TDD（Test-Driven Development）** は、以下のサイクルで開発を進める手法です：

```
┌─────────────────────────────────────────────────────────────┐
│                                                              │
│    🔴 Red                                                    │
│    ↓  失敗するテストを書く                                    │
│                                                              │
│    🟢 Green                                                  │
│    ↓  テストが通る最小限のコードを書く                         │
│                                                              │
│    🔵 Refactor                                               │
│       コードを改善する（テストは通ったまま）                    │
│                                                              │
│    → 最初に戻って繰り返す                                     │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### TDD のメリット

1. **バグの早期発見** - テストを先に書くことで仕様を明確にできる
2. **リファクタリングの安心感** - テストがあれば変更を恐れずにできる
3. **設計の改善** - テストしやすいコードは良い設計になりやすい

---

## 2.2 簡単な例で体験

### 題材: 足し算関数

まず、簡単な足し算関数を TDD で作ってみましょう。

### 🔴 Red: 失敗するテストを書く

`handson/test/add.test.ts` を作成します：

```typescript
import { add } from '../src/add';

describe('add 関数', () => {
  it('2つの数値を足し算できる', () => {
    expect(add(1, 2)).toBe(3);
  });
});
```

> **Note**: Jest はグローバルに `describe`, `it`, `expect` を提供するため、インポート不要です。

この時点でテストを実行すると、**失敗します**（`add` 関数が存在しないため）。

```bash
pnpm test handson/test/add.test.ts
```

### 🟢 Green: テストを通す

`handson/src/add.ts` を作成します：

```typescript
/**
 * 2つの数値を足し算する
 * @param a - 最初の数値
 * @param b - 2番目の数値
 * @returns 合計値
 */
export function add(a: number, b: number): number {
  return a + b;
}
```

テストを再実行すると、**成功します**。

```bash
pnpm test handson/test/add.test.ts
```

### 🔵 Refactor: 改善する

この例では特にリファクタリングの余地はありませんが、
実際の開発では以下のようなことを行います：

- 変数名をより明確にする
- 重複したコードを抽出する
- パフォーマンスを改善する

---

## 2.3 Cursor エージェントと TDD

Cursor のエージェントは TDD のサイクルを加速させてくれます：

### Red フェーズでの活用

```
add 関数のテストを書いてください。
以下のケースをカバーしてください：
- 正の数同士の足し算
- 負の数を含む足し算
- 0 を含む足し算
```

### Green フェーズでの活用

```
このテストを通す最小限の実装を書いてください。
```

### Refactor フェーズでの活用

```
このコードをリファクタリングしてください。
可読性と保守性を向上させてください。
```

---

## 2.4 演習: 引き算関数を TDD で作る

以下の手順で引き算関数を作成してみましょう：

1. **🔴 Red** - `handson/test/subtract.test.ts` にテストを書く
2. **🟢 Green** - `handson/src/subtract.ts` に実装を書く
3. **🔵 Refactor** - 必要に応じて改善

### ヒント

Cursor エージェントに以下のように依頼してみましょう：

```
subtract 関数のテストを TDD スタイルで作成してください。
まずテストファイル handson/test/subtract.test.ts を作成し、
その後 handson/src/subtract.ts に実装を作成してください。
```

---

## チェックリスト

以下が完了していることを確認してください：

- [ ] TDD の Red → Green → Refactor サイクルを理解した
- [ ] `add` 関数のテストと実装ができた
- [ ] `subtract` 関数のテストと実装ができた
- [ ] Cursor エージェントを使って TDD を体験した

---

## 次のステップ

👉 [03_todo_app_spec.md](./03_todo_app_spec.md) に進んで、TODO アプリの仕様を確認しましょう！
