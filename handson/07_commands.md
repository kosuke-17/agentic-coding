# ⚡ Step 7: Commands の作成

## 目標

- Cursor の Commands（コマンド）の仕組みを理解する
- カスタムコマンドを作成する
- 繰り返し使うワークフローを効率化する

---

## 7.1 Commands とは？

**Commands（コマンド）** は、よく使うワークフローを `/コマンド名` で呼び出せるようにする機能です。
`.cursor/commands/` ディレクトリに Markdown ファイルとして配置します。

### メリット

1. **再利用性** - 同じ操作を何度も書かなくて済む
2. **一貫性** - チーム全員が同じ操作を実行できる
3. **効率化** - 複雑な操作をワンコマンドで実行

---

## 7.2 コマンドファイルの構造

```markdown
---
description: コマンドの説明
---

# コマンドの内容

ここにエージェントへの指示を記述します。
```

---

## 7.3 実践: テスト実行コマンドを作成する

### コマンドファイルの作成

`.cursor/commands/run-handson-tests.md` を作成します：

```markdown
---
description: ハンズオン用のテストを実行する
---

# テスト実行

以下の手順でテストを実行してください：

1. handson/challenge/test/ ディレクトリのテストを実行
2. 結果をサマリーで報告
3. 失敗したテストがあれば原因を分析

## 実行コマンド

```bash
pnpm test handson/challenge/test/
```

## 報告フォーマット

- ✅ 成功したテスト数
- ❌ 失敗したテスト数
- 失敗したテストの詳細（あれば）
```

### 使い方

チャットで `/run-handson-tests` と入力すると、このコマンドが実行されます。

---

## 7.4 実践: TDD サイクルコマンドを作成する

### コマンドファイルの作成

`.cursor/commands/tdd-cycle.md` を作成します：

```markdown
---
description: TDD サイクル（Red → Green → Refactor）を実行する
---

# TDD サイクル実行

指定された機能を TDD で実装します。

## 入力

ユーザーからの入力:
- 機能名: {{feature}}
- ファイル: {{file}}

## 手順

### 1. 🔴 Red フェーズ

handson/challenge/test/logic/{{file}}.test.ts にテストを追加:
- 機能の仕様に基づいたテストケースを作成
- テストを実行して失敗を確認

### 2. 🟢 Green フェーズ

handson/challenge/src/logic/{{file}}.ts に実装を追加:
- テストが通る最小限のコードを実装
- テストを実行して成功を確認

### 3. 🔵 Refactor フェーズ

コードを改善:
- 重複を排除
- 可読性を向上
- テストが引き続き成功することを確認

## 報告

各フェーズの結果を報告してください。
```

### 使い方

```
/tdd-cycle
機能名: clearCompleted
ファイル: todo
```

---

## 7.5 実践: コードレビューコマンドを作成する

### コマンドファイルの作成

`.cursor/commands/review-handson.md` を作成します：

```markdown
---
description: ハンズオンコードのレビューを実行する
---

# コードレビュー

handson/challenge/ ディレクトリのコードをレビューします。

## レビュー観点

### 1. TDD 準拠

- [ ] テストが先に書かれているか
- [ ] テストカバレッジは十分か
- [ ] エッジケースがカバーされているか

### 2. コード品質

- [ ] 命名規則に従っているか
- [ ] 関数は単一責務か
- [ ] エラーハンドリングは適切か

### 3. TypeScript

- [ ] 型定義は適切か
- [ ] any 型を使っていないか
- [ ] 型推論が効いているか

### 4. ドキュメント

- [ ] JSDoc コメントがあるか
- [ ] 複雑なロジックに説明があるか

## 出力フォーマット

| 観点 | 状態 | コメント |
|------|------|---------|
| TDD 準拠 | ✅/❌ | ... |
| コード品質 | ✅/❌ | ... |
| TypeScript | ✅/❌ | ... |
| ドキュメント | ✅/❌ | ... |

改善が必要な場合は具体的な修正案を提示してください。
```

---

## 7.6 実践: ドキュメント生成コマンドを作成する

### コマンドファイルの作成

`.cursor/commands/generate-docs.md` を作成します：

```markdown
---
description: コードからドキュメントを生成する
---

# ドキュメント生成

handson/challenge/src/logic/ のコードから API ドキュメントを生成します。

## 対象

- handson/challenge/src/logic/todo.ts

## 出力形式

各関数について以下の情報を Markdown で出力:

### 関数名

**説明**
関数の目的と動作

**パラメータ**
| 名前 | 型 | 説明 |
|------|---|------|
| ... | ... | ... |

**戻り値**
型と説明

**使用例**
```typescript
// コード例
```

**注意事項**
- エラーがスローされる条件
- 副作用の有無

## 出力先

handson/challenge/docs/api.md として保存してください。
```

---

## 7.7 コマンドの一覧

作成したコマンドの一覧：

| コマンド | 説明 |
|---------|------|
| `/run-handson-tests` | テストを実行してレポート |
| `/tdd-cycle` | TDD サイクルを実行 |
| `/review-handson` | コードレビューを実行 |
| `/generate-docs` | ドキュメントを生成 |

---

## 7.8 演習: 独自コマンドを作成する

以下のコマンドを作成してみましょう：

### 演習1: リファクタリングコマンド

```
/refactor コマンドを作成してください。

機能:
- 指定されたファイルのリファクタリング提案
- 重複コードの検出
- 改善後のコード生成
```

### 演習2: テスト追加コマンド

```
/add-test コマンドを作成してください。

機能:
- 指定された関数のテストケースを追加
- エッジケースの自動検出
- テストファイルへの追記
```

---

## 7.9 Tips: 効果的なコマンドの作り方

### 小さく始める

```markdown
❌ 悪い例: 複雑すぎる
「全てのコードをレビューして、リファクタリングして、テストを追加して、ドキュメントを生成」

✅ 良い例: シンプル
「指定されたファイルのテストを実行」
```

### 明確な入出力

```markdown
✅ 良い例: 入出力が明確
## 入力
- ファイルパス: {{path}}

## 出力
- テスト結果のサマリー
- 失敗時の詳細
```

### 再利用可能に

```markdown
✅ 良い例: 汎用的
## 対象
{{targetFile}} のテストを実行

❌ 悪い例: 固定的
## 対象
handson/challenge/src/logic/todo.ts のテストを実行
```

---

## チェックリスト

以下が完了していることを確認してください：

- [ ] Commands の仕組みを理解した
- [ ] テスト実行コマンドを作成した
- [ ] TDD サイクルコマンドを作成した
- [ ] コードレビューコマンドを作成した
- [ ] ドキュメント生成コマンドを作成した
- [ ] コマンドを実行して動作を確認した

---

## 次のステップ

👉 [08_practice_tasks.md](./08_practice_tasks.md) に進んで、実践タスクに挑戦しましょう！
